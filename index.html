<!doctype html>
<html lang="pt-PT">

<head>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&family=Luckiest+Guy&family=Sriracha&display=swap" rel="stylesheet">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mapa OSM Online</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  :root {
    --bg: #F5E9D0;
    --accent: #E47D29;
    --card: #fff;
    --muted: #6b6b6b;
    --glass: rgba(255, 255, 255, 0.88);
    --panel-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);

    /* Fontes */
    --font-body: 'Heebo', sans-serif;
    --font-title: 'Luckiest Guy', cursive;
    --font-subtitle: 'Sriracha', cursive;
  }

  html,
  body {
    height: 100%;
    margin: 0;
    font-family: var(--font-body);
    background: var(--bg);
  }

  #map {
    height: 100vh;
    width: 100%;
  }

  /* Search (top-right) */
  .search-box {
    position: absolute;
    top: 12px;
    right: 20px;
    z-index: 1400;
  }

  .search-box input {
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid #ccc;
    width: 280px;
    font-size: 14px;
    background: #fff;
    font-family: var(--font-body);
  }

  .search-box input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 6px rgba(228, 125, 41, 0.18);
  }

  #searchResults {
    position: absolute;
    top: 46px;
    right: 0;
    z-index: 1500;
    width: 350px;
    max-height: 300px;
    overflow-y: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    display: none;
    padding: 10px;
    font-family: var(--font-body);
  }

  #searchResults li {
    list-style: none;
    padding: 10px;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: var(--font-body);
  }

  #searchResults li:hover {
    background: #fbefe0;
  }

  .result-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .result-item img {
    width: 40px;
    height: 40px;
    object-fit: cover;
    border-radius: 6px;
    background-color: #eee;
  }

  .result-item .m-title {
    font-weight: bold;
    color: var(--accent);   
    font-family: var(--font-title); /* LUCKIEST GUY */
    font-weight: 400;
  letter-spacing: 0.1em;
  }

  .result-item .m-cat {
    font-size: 12px;
    color: var(--muted);
    font-family: var(--font-subtitle);
    
  }

  /* Bot√£o Digitais */
  #digitalBtn {
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 1500;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: var(--accent);
    color: #fff;
    font-size: 24px;
    border: none;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.18);
    transition: transform 0.2s ease, background 0.2s;
    font-family: var(--font-body);
  }

  #digitalBtn:hover {
    background: #d66a1f;
    transform: scale(1.05);
  }

  #digitalPanel {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 360px;
    max-height: 70vh;
    background: var(--glass);
    backdrop-filter: blur(6px);
    border-radius: 12px;
    box-shadow: var(--panel-shadow);
    border: 1px solid rgba(0, 0, 0, 0.08);
    display: none;
    flex-direction: column;
    z-index: 2000;
    overflow: hidden;
    animation: fadeIn 0.2s ease;
    font-family: var(--font-body);
  }

  #digitalPanel.open {
    display: flex;
  }

  #digitalPanel h3 {
    margin: 0;
    padding: 12px 16px;
    background: var(--accent);
    color: white;
    font-size: 16px;
    text-align: center;
    font-family: var(--font-subtitle);
  }

  #digitalList {
    list-style: none;
    margin: 0;
    padding: 10px;
    overflow-y: auto;
    flex: 1;
  }

  #digitalList li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-bottom: 1px solid #f0f0f0;
    cursor: pointer;
    background: white;
    border-radius: 8px;
    margin-bottom: 6px;
    font-family: var(--font-body);
  }

  #digitalList li:hover {
    background: #fbefe0;
  }

  #digitalList img {
    width: 44px;
    height: 44px;
    border-radius: 6px;
    object-fit: cover;
    background: #eee;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .side-panel {
    position: fixed;
    right: 18px;
    top: 56px;
    width: 35%;
    max-width: 400px;
    min-width: 280px;
    height: calc(100vh - 96px);
    background: var(--glass);
    border-radius: 12px;
    box-shadow: var(--panel-shadow);
    z-index: 2000;
    transform: translateX(420px);
    transition: transform 260ms ease;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(0, 0, 0, 0.04);
    backdrop-filter: blur(4px);
    font-family: var(--font-body);
  }

  .side-panel.open {
    transform: translateX(0);
  }

  @media(max-width:900px) {
    .side-panel {
      width: 90%;
      right: 6px;
      transform: translateX(110%);
    }
  }

  .panel-header {
    position: relative;
    padding: 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.98));
  }

  .panel-header img {
    width: 300px;
    height: 200px;
    object-fit: cover;
    border-radius: 12px;
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12);
    border: 4px solid rgba(255, 255, 255, 0.85);
    background: #eee;
  }

  .panel-name {
    font-size: 20px;
    font-weight: 800;
    color: var(--accent);
    text-align: center;
    margin-top: 6px;
    font-family: var(--font-title); /* LUCKIEST GUY */
    font-weight: 400;
  letter-spacing: 0.1em;
  }

  .panel-cat {
    font-size: 13px;
    color: var(--muted);
    text-align: center;
    font-family: var(--font-subtitle);
  }

  .media-row {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    margin-top: 6px;
  }

  .media-row a {
    display: inline-flex;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    border: 1px solid rgba(0, 0, 0, 0.06);
    background: #fff;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    font-size: 16px;
  }

  .panel-body {
    padding: 12px 16px;
    margin: 0 20px;
    overflow: auto;
    flex: 1;
  }

    .panel-about {
    margin: 0 15px;
  }

  .section-title {
    color: var(--accent);
    font-weight: 700;
    padding-left: 15%;
    margin: 5px 0px;
    font-size: 13px;
    font-family: var(--font-subtitle); /* SRIRACHA */
    letter-spacing: 0.1em;
  }
  
  .section-about-title {
    color: var(--accent);
    font-weight: 700;
    margin: 5px 0;
    font-size: 13px;
    font-family: var(--font-subtitle); /* SRIRACHA */
    letter-spacing: 0.1em;
  }

  .about {
    font-size: 14px;
    color: #333;
    margin-bottom: 12px;
    white-space: pre-wrap;
    font-family: var(--font-body);
  }

  .info-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin: 4px 4px;
  }

  .info-icon {
    width: 34px;
    height: 34px;
    border-radius: 8px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex: 0 0 34px;
  }

  .info-text {
    font-size: 14px;
    color: #333;
    word-break: break-word;
    font-family: var(--font-body);
  }

  .static-activities {
    margin-top: 12px;
    padding: 10px;
    background: #fff6f0;
    border-radius: 8px;
    border: 1px solid rgba(228, 125, 41, 0.06);
    color: var(--muted);
    font-size: 13px;
    font-family: var(--font-body);
  }

  .panel-close {
    position: absolute;
    right: 12px;
    top: 12px;
    background: rgba(0, 0, 0, 0.06);
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: none;
  }

  /* Filters bottom-left */
  .filter-panel {
    position: absolute;
    left: 16px;
    bottom: 16px;
    z-index: 1300;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    max-width: 260px;
    font-family: var(--font-body);
  }

  .filter-item {
    border-radius: 25px;
    background: #fff;
    cursor: pointer;
    font-weight: 700;
    color: var(--accent);
    font-size: 13px;
    font-family: var(--font-subtitle); /* SRIRACHA */
  }

  .filter-item.active {
    background: var(--accent);
    color: #fff;
  }

  .filter-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: center;
  }

  .toggle-all {
    padding: 6px 10px;
   margin-left: 40%;
    border-radius: 8px;
    background: var(--accent);
    color: #fff;
    border: none;
    cursor: pointer;
    font-family: var(--font-body);
  }

#toggleFilterBtn {
  position: absolute;
  bottom: 28px; /* antes era top: 16px */
  left: 16px;
  z-index: 1400;
  width: 44px;
  height: 44px;
  border-radius: 8px;
  background: var(--accent);
  color: #fff;
  font-size: 20px;
  border: none;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.18);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s ease, background 0.2s;
}

/* Ocultar o painel de filtros por padr√£o */
.filter-panel {
  display: none; /* agora come√ßa oculto */
}
.filter-panel.open {
  display: flex; /* exibe quando tiver a classe open */
}


#toggleFilterBtn:hover {
  background: #d66a1f;
  transform: scale(1.05);
}


  /* leaflet z-index */
  .leaflet-container {
    z-index: 0;
    font-family: var(--font-body);
  }
</style>

</head>

<body>

  <div class="search-box">
    <input id="searchInput" type="text" placeholder="üîç Pesquisar organiza√ß√µes..." />
    <ul id="searchResults"></ul>
  </div>

  <!-- Bot√£o Digitais -->
  <button id="digitalBtn" title="Ver Associa√ß√µes Digitais">üíª</button>

  <!-- Painel com lista de Digitais -->
  <div id="digitalPanel">
    <h3>üåê Associa√ß√µes Digitais</h3>
    <ul id="digitalList"></ul>
  </div>


  <div id="map"></div>

  <!-- Filters bottom-left -->
  <div id="filterPanel" class="filter-panel" aria-hidden="false"></div>
  
<!-- Bot√£o para mostrar filtros -->
<button id="toggleFilterBtn" title="Mostrar Filtros">‚ò∞</button>


  <!-- SIDE PANEL -->
  <aside id="sidePanel" class="side-panel" aria-hidden="true">
    <div class="panel-header">
      <button id="closePanel" class="panel-close" title="Fechar">‚úï</button>
      <img id="panelImg" src="" alt="Imagem" />
      <div class="panel-name" id="panelName">Nome</div>
      <div class="panel-cat" id="panelCat">Categoria</div>
      <div class="media-row" id="panelMedia"></div>
    </div>
    <div class="panel-about">
            <div>
        <div class="section-about-title">Sobre</div>
        <div class="about" id="panelAbout">Proposito</div>
      </div>
    </div>

    <div class="panel-body" id="panelBody">
      <div>
        <div class="section-title">Morada</div>
        <div class="info-row">
          <div class="info-icon">
            <img src="icons_list/iconAddress.svg" alt="Morada" class="icon-svg">
          </div>
          <div class="info-text" id="panelAddress">Endere√ßo completo</div>
        </div>

        <div class="section-title">Telefone</div>
        <div class="info-row">
          <div class="info-icon">
            <img src="icons_list/iconCall.svg" alt="Telefone" class="icon-svg">
          </div>
          <div class="info-text" id="panelPhone">+351 ...</div>
        </div>

        <div class="section-title">Email</div>
        <div class="info-row">
          <div class="info-icon">
            <img src="icons_list/iconEmail.svg" alt="Email" class="icon-svg">
          </div>
          <div class="info-text" id="panelEmail">email@exemplo.pt</div>
        </div>

        <div class="section-title">Website</div>
        <div class="info-row">
          <div class="info-icon">
            <img src="icons_list/iconWebsite.svg" alt="Website" class="icon-svg">
          </div>
          <div class="info-text" id="panelWebsite">https://...</div>
        </div>

        <div class="info-row">

          <div class="static-activities">
            Atividades: exposi√ß√µes, oficinas, congressos e eventos....
          </div>
        </div>
      </div>
    </div>
  </aside>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // === Bot√£o para mostrar/esconder filtros ===
  const toggleFilterBtn = document.getElementById('toggleFilterBtn');
  const filterPanel = document.getElementById('filterPanel');

  toggleFilterBtn.addEventListener('click', () => {
    if (filterPanel.style.display === 'flex' || filterPanel.style.display === '') {
      filterPanel.style.display = 'none';
    } else {
      filterPanel.style.display = 'flex';
    }
  });

  // Opcional: Fechar painel ao clicar fora (mobile-friendly)
  document.addEventListener('click', (e) => {
    if (
      filterPanel.style.display === 'flex' &&
      !filterPanel.contains(e.target) &&
      e.target !== toggleFilterBtn
    ) {
      filterPanel.style.display = 'none';
    }
  });

  // Mant√©m o restante do seu script atual (Leaflet, pesquisa, painel lateral, etc.)
  fetch('data.json').then(r => r.json()).then(data => {
    const todos = Array.isArray(data) ? data : [];

    const fisicas = todos.filter(d => (d.type || '').toLowerCase() === 'fisica' && d.address && d.address.latitude && d.address.longitude);
    const digitais = todos.filter(d => (d.type || '').toLowerCase() === 'digital');
    const pesquisaveis = [...fisicas, ...digitais];

    const map = L.map('map').setView([38.72, -9.18], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const sidePanel = document.getElementById('sidePanel');
    const closePanelBtn = document.getElementById('closePanel');
    const panelImg = document.getElementById('panelImg');
    const panelName = document.getElementById('panelName');
    const panelCat = document.getElementById('panelCat');
    const panelMedia = document.getElementById('panelMedia');
    const panelAbout = document.getElementById('panelAbout');
    const panelAddress = document.getElementById('panelAddress');
    const panelPhone = document.getElementById('panelPhone');
    const panelEmail = document.getElementById('panelEmail');
    const panelWebsite = document.getElementById('panelWebsite');

    function gerarPopupHTML(o) {
      const thumb = o.img
        ? `<img src="${o.img}" alt="${(o.nome || '')}" style="width:48px;height:48px;object-fit:cover;border-radius:50%;border:none;" />`
        : '';
      return `<div class="mini-popup" style="display:flex;align-items:center;gap:10px;">
        ${thumb}
        <div class="m-title" style="color:var(--accent);font-weight:700;font-size:15px;">
          ${o.nome || ''}
        </div>
      </div>`;
    }

    function openPanelFor(o) {
      if (o.img) {
        panelImg.src = o.img;
        panelImg.style.display = 'block';
      } else {
        panelImg.src = '';
        panelImg.style.display = 'none';
      }

      panelName.textContent = o.nome || '-';
      const categoriaMap = {
        'grupo': 'Grupo',
        'coletivo_cultural': 'Coletivo Cultural',
        'associacao': 'Associa√ß√£o',
        'empresa_social': 'Empresa Social',
        'outros': 'Outros'
      };
      panelCat.textContent = categoriaMap[o.categoria?.toLowerCase()] || (o.categoria ? o.categoria.charAt(0).toUpperCase() + o.categoria.slice(1) : '-');
      panelAbout.textContent = o.proposito || o.description || o.sobre || 'Sem descri√ß√£o dispon√≠vel.';

      // Morada
      if (o.address && (o.address.latitude && o.address.longitude)) {
        const lat = o.address.latitude;
        const lon = o.address.longitude;
        const addr = o.address.fullAddress || 'Abrir no Google Maps';
        panelAddress.innerHTML = `<a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank" rel="noopener" style="color:var(--muted); text-decoration:none">${addr}</a>`;
      } else if (o.address && o.address.fullAddress) {
        const addr = o.address.fullAddress;
        const query = encodeURIComponent(addr);
        panelAddress.innerHTML = `<a href="https://www.google.com/maps/search/?api=1&query=${query}" target="_blank" rel="noopener" style="color:var(--muted); text-decoration:none">${addr}</a>`;
      } else {
        panelAddress.textContent = 'N√£o possui morada f√≠sica.';
      }

      // Telefone
      panelPhone.innerHTML = o.telefone
        ? `<a href="tel:${o.telefone}" style="color:var(--muted); text-decoration:none">${o.telefone}</a>`
        : 'N√£o possui telefone.';

      // Email
      panelEmail.innerHTML = o.eMail
        ? `<a href="mailto:${o.eMail}" style="color:var(--muted); text-decoration:none">${o.eMail}</a>`
        : 'N√£o possui email.';

      // Website
      panelWebsite.innerHTML = o.website
        ? `<a href="${o.website}" target="_blank" rel="noopener" style="color:var(--muted); text-decoration:none">${o.website}</a>`
        : 'N√£o possui website.';

      // Redes sociais
      panelMedia.innerHTML = '';
      const links = o.mediaLinks || {};
      const icons = {
        twitter: 'icons_list/Twitter.svg',
        youtube: 'icons_list/Youtube.svg',
        instagram: 'icons_list/Instagram.svg',
        linkedin: 'icons_list/Linkedin.svg',
        thread: 'icons_list/Thread.svg',
        facebook: 'icons_list/Facebook.svg',
        tiktok: 'icons_list/Tiktok.svg'
      };

      Object.entries(links).forEach(([key, url]) => {
        if (url) {
          const a = document.createElement('a');
          a.href = url;
          a.target = '_blank';
          a.rel = 'noopener';
          const img = document.createElement('img');
          img.src = icons[key];
          img.alt = key;
          img.style.width = '24px';
          img.style.height = '24px';
          img.style.objectFit = 'contain';
          a.appendChild(img);
          panelMedia.appendChild(a);
        }
      });

      sidePanel.classList.add('open');
      sidePanel.setAttribute('aria-hidden', 'false');
    }

    function closePanel() {
      sidePanel.classList.remove('open');
      sidePanel.setAttribute('aria-hidden', 'true');
    }
    closePanelBtn.addEventListener('click', closePanel);

    // === Marcadores ===
    const categorias = {};
    fisicas.forEach(o => {
      const cat = o.categoria || 'Outros';
      if (!categorias[cat]) categorias[cat] = [];
      categorias[cat].push(o);
    });

    const layers = {};
    const allMarkers = [];

    Object.entries(categorias).forEach(([cat, orgs]) => {
      const layer = L.layerGroup();
      orgs.forEach(o => {
        const lat = parseFloat(o.address.latitude), lon = parseFloat(o.address.longitude);
        if (isNaN(lat) || isNaN(lon)) return;
        const marker = L.marker([lat, lon], {
          icon: L.icon({
            iconUrl: `icons/${cat}.svg`,
            iconSize: [44, 44],
            iconAnchor: [22, 22],
            popupAnchor: [0, -22]
          })
        });
        marker.bindPopup(gerarPopupHTML(o), { closeButton: false, offset: [0, -8] });
        marker.on('click', () => { marker.openPopup(); openPanelFor(o); map.panTo([lat, lon], { animate: true }); });
        marker.addTo(layer);
        marker.orgData = o;
        allMarkers.push(marker);
      });
      layers[cat] = layer;
      layer.addTo(map);
    });

    // === Filtros ===
    const filterPanelElem = document.getElementById('filterPanel');
    Object.keys(layers).forEach(cat => {
      const btn = document.createElement('div');
      btn.className = 'filter-item active';
      const iconUrl = `icons_filter/${cat}.svg`;
      const iconImg = document.createElement('img');
      iconImg.src = iconUrl;
      iconImg.alt = cat;
      iconImg.style.width = '60px';
      iconImg.style.height = '60px';
      iconImg.style.objectFit = 'contain';
      btn.appendChild(iconImg);
      const categoryName = document.createElement('span');
      categoryName.textContent = cat;
      categoryName.style.display = 'none';
      btn.appendChild(categoryName);

      btn.addEventListener('click', () => {
        if (map.hasLayer(layers[cat])) { map.removeLayer(layers[cat]); btn.classList.remove('active'); }
        else { map.addLayer(layers[cat]); btn.classList.add('active'); }
      });

      filterPanelElem.appendChild(btn);
    });

    // === Bot√£o alternar todos ===
    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'filter-controls';
    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'toggle-all';
    toggleBtn.textContent = 'Ocultar Todas';
    let allVisible = true;
    toggleBtn.addEventListener('click', () => {
      allVisible = !allVisible;
      toggleBtn.textContent = allVisible ? 'Ocultar Todas' : 'Mostrar Todas';
      Object.entries(layers).forEach(([cat, layer]) => {
        const btn = Array.from(filterPanelElem.children).find(el => el.textContent === cat);
        if (allVisible) { map.addLayer(layer); btn.classList.add('active'); }
        else { map.removeLayer(layer); btn.classList.remove('active'); }
      });
    });
    controlsDiv.appendChild(toggleBtn);
    filterPanelElem.appendChild(controlsDiv);
  }).catch(err => { console.error('Erro a carregar data.json', err); alert('Erro a carregar data.json ‚Äî ver console.'); });
</script>



</body>

</html>